# 消息路由

# 多个消费者

当多个消费者从同一主题中读取消息时，有使用两种主要的消息传递模式：

- 负载均衡（load balance）：每条消息都被传递给消费者之一，所以处理该主题下消息的工作能被多个消费者共享。代理可以为消费者任意分配消息。当处理消息的代价高昂，希望能并行处理消息时，此模式非常有用（在 AMQP 中，可以通过让多个客户端从同一个队列中消费来实现负载均衡，而在 JMS 中则称之为共享订阅（shared subscription））。

- 扇出（fan-out）：每条消息都被传递给所有消费者。扇出允许几个独立的消费者各自“收听”相同的消息广播，而不会相互影响：这个流处理中的概念对应批处理中多个不同批处理作业读取同一份输入文件（JMS 中的主题订阅与 AMQP 中的交叉绑定提供了这一功能）。

![（a）负载平衡：在消费者间共享消费主题；（b）扇出：将每条消息传递给多个消费者。](https://s2.ax1x.com/2020/02/13/1Oc2Q0.md.png)

两种模式可以组合使用：例如，两个独立的消费者组可以每组各订阅一个主题，每一组都共同收到所有消息，但在每一组内部，每条消息仅由单个节点处理。
